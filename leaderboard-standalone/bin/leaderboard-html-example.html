<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' type="text/javascript"></script>
<script type="text/javascript">

var url = "http://localhost:4567/lb/";
//var url = "http://130.206.83.3:4567/lb/";

function submitScore(gameID, playerID, score) {
	var pstr = url + gameID + "/" + playerID + "/score";
	$.ajax({
		url: pstr,
		data: JSON.stringify({
				scoreEntries: [
					{name:"highscore", value:score}
				]
				//authentication: ...,
				//userData: ...
			}),
		processData: false,
		type: 'POST',
		contentType: 'text/plain', //'application/json',  cross site posting an application/json requires to implement the CORS preflight with OPTIONS, so this is a simple hacky workaround as the leaderboard server doesn't check the content-type
	});
}

function getRankingPos(gameID, playerID) {
	var rstr = url + gameID + "/" + playerID + "/rankingposition";

	$.get(rstr, {
			//
		},
		null,
		"jsonp").done(function(data) {
			var txt = "player position: " +  data.position;
			document.getElementById("highestScore").innerHTML = txt;
	});
}

function getRankedList(gameID) {
	var rstr = url + gameID + "/rankedlist";

	$.get(rstr, {}, null, "jsonp").done(function(data) {
		var txt = "<table>";
		for (var i=0; i<data.length; i++) {
			txt += "<tr><td>" + (i+1) + ".</td><td>" + data[i].highscore + " points </td><td>by: " + data[i].playerID + "</td>"
			if (data[i].imgURL) {
				txt += "<td><img src='" + data[i].imgURL + "' width='32'></td>";
			}
			txt += "</tr>";
		}
		txt += "</table>";
		document.getElementById("rankedlist").innerHTML = txt;
		//$('#rankedlist').html(txt);
	});
}

function createGame(gameID) {
	var pstr = url + gameID;

	$.ajax({
		url: pstr,
		data: "",
		//processData: false,
		type: "PUT",
crossDomain: true
//dataType: "jsonp",
//		contentType: 'text/plain' //'application/json',  cross site posting an application/json requires to implement the CORS preflight with OPTIONS, so this is a simple hacky workaround as the leaderboard server doesn't check the content-type
	});
}

function deleteGame(gameID) {
	var pstr = url + gameID;

	$.ajax({
		url: pstr,
		data: "",
		processData: false,
		type: "DELETE",
		contentType: 'text/plain', //'application/json',  cross site posting an application/json requires to implement the CORS preflight with OPTIONS, so this is a simple hacky workaround as the leaderboard server doesn't check the content-type
	});
}

</script>
</head>
<body>

<script>
document.write("Server: " + url + "<br>\n");
</script>

<form>
game id: <input type="text" id="myGameID" value="game1"> <button type="button" onclick="createGame(document.getElementById('myGameID').value);return false;" onsubmit="return false;">create new game in database</button> <button type="button" onclick="deleteGame(document.getElementById('myGameID').value)">delete game from database</button><br>
player ID: <input type="text" id="myPlayerID" value="?"><br>
score <input type="text" id="myScore" value="2"><button type="button" onclick="submitScore(document.getElementById('myGameID').value, document.getElementById('myPlayerID').value, document.getElementById('myScore').value)">post score</button>(uses player ID from text field above)<br>
user's highest score: <div id="highestScore">-</div> <button type="button" onclick="getRankingPos(document.getElementById('myGameID').value, document.getElementById('myPlayerID').value)">get</button>(uses player ID from text field above)<br>
<p>
<button type="button" onclick="getRankedList(document.getElementById('myGameID').value)">show ranked list</button>
</p>
</form> 
<div id="rankedlist">-</div>

</body>
</html>